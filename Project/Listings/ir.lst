C51 COMPILER V9.60.0.0   IR                                                                09/13/2021 13:25:33 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\ir.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Src\ir.c OPTIMIZE(7,SPEED) BROWSE INCDIR(..\Inc) DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\ir.lst) OBJECT(.\Objects\ir.obj)

line level    source

   1          #include "main.h"
   2          #include "ir.h"
   3          #include "bsp_lib.h"
   4          volatile u8  gired_data[4];
   5          static u8 code key_table[17] = {69, 70, 71, 68, 64, 67,
   6                                             7, 21, 9, 25, 22, 13, 24, 82, 8, 90, 28};
   7          extern u8 key_flag;
   8          extern u8 STA_Mode;
   9          void IR_init(void)
  10          {
  11   1          IT0 = 1; //ä½¿èƒ½ INT0 ä¸‹é™æ²¿ä¸­æ–­
  12   1          EX0 = 1; //ä½¿èƒ½ INT0 ä¸­æ–­
  13   1          EA = 1;
  14   1          IRED = 1; //I/Oå£åˆå§‹åŒ–
  15   1      }
  16          extern char flag_running;
  17          extern u8 STA_F;    //é»˜è®¤æ˜¯F1æ¨¡å¼
  18          extern u8 STA_P;    //é»˜è®¤æ˜¯F1æ¨¡å¼
  19          extern u8 STA_main; //ä¸»è¦çš„çŠ¶æ€æ ‡å¿—ä½
  20          extern unsigned long cnt_s, cnt_hour, cnt_min;
  21          extern unsigned char tim_yuyue;
  22          void ired() interrupt 0 //å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•°
  23          {
  24   1          u8 ired_high_time = 0;
  25   1          u16 time_cnt = 0;
  26   1          u8 i = 0, j = 0;
  27   1          static char flag_lock = 0;
  28   1          if (IRED == 0)
  29   1          {
  30   2              time_cnt = 15;
  31   2              while ((!IRED) && (time_cnt)) //ç­‰å¾…å¼•å¯¼ä¿¡å·9msä½ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡10mså¼ºåˆ¶é€€å‡º
  32   2              {
  33   3                  delay_ms(1);
  34   3                  time_cnt--;
  35   3                  if (time_cnt == 0)
  36   3                      return;
  37   3              }
  38   2              if (IRED) //å¼•å¯¼ä¿¡å·9msä½ç”µå¹³å·²è¿‡ï¼Œè¿›å…¥4.5msé«˜ç”µå¹³
  39   2              {
  40   3                  time_cnt = 7;
  41   3                  while (IRED && time_cnt) //ç­‰å¾…å¼•å¯¼ä¿¡å·4.5msé«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡5mså¼ºåˆ¶é€€å‡º
  42   3                  {
  43   4                      delay_ms(1);
  44   4                      time_cnt--;
  45   4                      if (time_cnt == 0)
  46   4                          return;
  47   4                  }
  48   3                  for (i = 0; i < 4; i++) //å¾ªç¯4æ¬¡ï¼Œè¯»å–4ä¸ªå­—èŠ‚æ•°æ®
  49   3                  {
  50   4                      for (j = 0; j < 8; j++) //å¾ªç¯8æ¬¡è¯»å–æ¯ä½æ•°æ®å³ä¸€ä¸ªå­—èŠ‚
  51   4                      {
  52   5                          // time_cnt = 600;
  53   5                          while ((IRED == 0) && time_cnt) //ç­‰å¾…æ•°æ®1æˆ–0å‰é¢çš„0.56msç»“æŸï¼Œè‹¥è¶…è¿‡6m
             -så¼ºåˆ¶é€€å‡º
C51 COMPILER V9.60.0.0   IR                                                                09/13/2021 13:25:33 PAGE 2   

  54   5                          {
  55   6                              delay_us(5);
  56   6                              // time_cnt--;
  57   6                              // if (time_cnt == 0)
  58   6                              // {
  59   6                              //     return;
  60   6                              // }
  61   6                          }
  62   5                          time_cnt = 15;
  63   5                          while (IRED) //ç­‰å¾…æ•°æ®1æˆ–0åé¢çš„é«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡2mså¼ºåˆ¶é€€å‡º
  64   5                          {
  65   6                              delay_10us(10); //çº¦0.1ms
  66   6                              ired_high_time++;
  67   6                              if (ired_high_time > 20)
  68   6                                  return;
  69   6                          }
  70   5                          gired_data[i] >>= 1;     //å…ˆè¯»å–çš„ä¸ºä½ä½ï¼Œç„¶åæ˜¯é«˜ä½
  71   5                          if (ired_high_time >= 8) //å¦‚æœé«˜ç”µå¹³æ—¶é—´å¤§äº0.8msï¼Œæ•°æ®åˆ™ä¸º1ï¼Œå¦åˆ™ä¸
             -º0
  72   5                              gired_data[i] |= 0x80;
  73   5                          ired_high_time = 0; //é‡æ–°æ¸…é›¶ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è®¡ç®—æ—¶é—´
  74   5                      }
  75   4                  }
  76   3              }
  77   2              if (gired_data[2] != ~gired_data[3]) //æ ¡éªŒæ§åˆ¶ç ä¸åç ï¼Œé”™è¯¯åˆ™è¿”å›
  78   2              {
  79   3      
  80   3                  for (i = 0; i < 4; i++)
  81   3                      gired_data[i] = 0;
  82   3                  return;
  83   3              }
  84   2              for (i = 0; i < 17; i++)
  85   2              {
  86   3                  if (gired_data[2] == key_table[i])
  87   3                  {
  88   4                      key_flag = i;
  89   4                      if (key_flag == 16)
  90   4                      {
  91   5                          if (flag_lock % 2 == 0)
  92   5                          {
  93   6                              STA_main = STA_main | 0x40;
  94   6                          }
  95   5                          else
  96   5                          {
  97   6                              STA_main = STA_main & 0xbf;
  98   6                          }
  99   5                          flag_lock++;
 100   5                      }
 101   4                      if ((STA_main & 0x40) != 0x40)
 102   4                      {
 103   5                          if ((key_flag == 15) && ((STA_main & 0x80) == 0x80) && ((STA_main & 0x20) != 0x20))
 104   5                          {
 105   6                              STA_F++;
 106   6                              if (STA_F > 9)
 107   6                              {
 108   7                                  STA_F = 9;
 109   7                              }
 110   6                          }
 111   5                          else if ((key_flag == 14) && ((STA_main & 0x80) == 0x80) && ((STA_main & 0x20) != 0x20
             -))
 112   5                          {
 113   6                              STA_F--;
C51 COMPILER V9.60.0.0   IR                                                                09/13/2021 13:25:33 PAGE 3   

 114   6                              if (STA_F < 1)
 115   6                              {
 116   7                                  STA_F = 1;
 117   7                              }
 118   6                          }
 119   5                          else if ((key_flag == 3) || (key_flag == 4) || (key_flag == 5))
 120   5                          {
 121   6                              STA_Mode = key_flag - 2;
 122   6                          }
 123   5                          else if ((key_flag == 12) && ((STA_main & 0x80) == 0x80))
 124   5                          {
 125   6                              STA_P++;
 126   6                              if (STA_P > 9)
 127   6                              {
 128   7                                  STA_P = 9;
 129   7                              }
 130   6                          }
 131   5                          else if ((key_flag == 13) && ((STA_main & 0x80) == 0x80))
 132   5                          {
 133   6                              STA_P--;
 134   6                              if (STA_P < 1)
 135   6                              {
 136   7                                  STA_P = 1;
 137   7                              }
 138   6                          }
 139   5                          else if ((key_flag == 1) && ((STA_main & 0x80) == 0x80) && ((STA_main & 0x20) != 0x20)
             -) //æ­£åœ¨è¿è¡Œæ—¶ç¬¬ä¸€æ¬¡æŒ‰ä¸‹é¢„çº¦
 140   5                          {
 141   6                              STA_main = STA_main & 0x7f;
 142   6                              cnt_s = 0;
 143   6                              cnt_min = 0;
 144   6                              cnt_hour = 0; //è®¡æ—¶å½’é›¶
 145   6                              tim_yuyue = 0;
 146   6                              STA_main = STA_main | 0x20; //è®°å½•é¢„çº¦çŠ¶æ€
 147   6                          }
 148   5                          else if ((key_flag == 1) && ((STA_main & 0x20) == 0x20)) //ç¬¬äºŒæ¬¡æŒ‰ä¸‹é¢„çº¦
 149   5                          {
 150   6                              STA_main = STA_main & 0x7f;
 151   6                              STA_main = STA_main & 0xbf; //æ¸…é™¤é¢„çº¦çŠ¶æ€
 152   6                              STA_main = STA_main | 0x10; //è®°å½•å¼€å§‹è®¡æ—¶çŠ¶æ€
 153   6                              cnt_hour = 0;               //è®¡æ—¶å½’é›¶
 154   6                              stop_mode();
 155   6                          }
 156   5                          else if ((key_flag == 2) && (((STA_main & 0x10) == 0x10) || ((STA_main & 0x20) == 0x20
             -))) //é¢„çº¦è®¡æ—¶è¿‡ç¨‹æˆ–è€…é¢„çº¦ä¸­æŒ‰ä¸‹åœæ­¢é¢„çº¦
 157   5                          {
 158   6                              STA_main = 0x80;
 159   6                              STA_main = STA_main & 0xdf; //æ¸…é™¤å¼€å§‹è®¡æ—¶çŠ¶æ€
 160   6                              STA_main = STA_main & 0xbf; //æ¸…é™¤é¢„çº¦çŠ¶æ€
 161   6                          }
 162   5                          else if ((key_flag == 0)) //é¢„çº¦è®¡æ—¶è¿‡ç¨‹æˆ–è€…é¢„çº¦ä¸­æŒ‰ä¸‹åœæ­¢é¢„çº¦
 163   5                          {
 164   6                              STA_main = STA_main | 0x08;
 165   6                          }
 166   5                          if ((STA_main & 0x20) == 0x20)
 167   5                          {
 168   6                              if (key_flag == 15)
 169   6                              {
 170   7                                  tim_yuyue++;
 171   7                                  if (tim_yuyue > 8)
 172   7                                  {
 173   8                                      tim_yuyue = 8;
C51 COMPILER V9.60.0.0   IR                                                                09/13/2021 13:25:33 PAGE 4   

 174   8                                  }
 175   7                              }
 176   6                              else if (key_flag == 14)
 177   6                              {
 178   7                                  tim_yuyue--;
 179   7                                  if (tim_yuyue < 1)
 180   7                                  {
 181   8                                      tim_yuyue = 1;
 182   8                                  }
 183   7                              }
 184   6                          }
 185   5                      }
 186   4                  }
 187   3              }
 188   2          }
 189   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    810    ----
   CONSTANT SIZE    =     17    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
