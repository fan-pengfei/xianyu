C51 COMPILER V9.60.0.0   IR                                                                09/11/2021 10:27:04 PAGE 1   


C51 COMPILER V9.60.0.0, COMPILATION OF MODULE IR
OBJECT MODULE PLACED IN .\Objects\ir.obj
COMPILER INVOKED BY: D:\Keil_v5\C51\BIN\C51.EXE ..\Src\ir.c OPTIMIZE(7,SPEED) BROWSE INCDIR(..\Inc) DEBUG OBJECTEXTEND P
                    -RINT(.\Listings\ir.lst) OBJECT(.\Objects\ir.obj)

line level    source

   1          #include "main.h"
   2          #include "ir.h"
   3          #include "bsp_lib.h"
   4          volatile u8 gired_data[4];
   5          volatile u8 key_table[17] = {69, 70, 71, 68, 64, 67,
   6                                       7, 21, 9, 25, 22, 13, 24, 82, 8, 90, 28};
   7          extern u8 key_flag;
   8          extern u8 STA_Mode;
   9          void IR_init(void)
  10          {
  11   1          IT0 = 1; //ä½¿èƒ½ INT0 ä¸‹é™æ²¿ä¸­æ–­
  12   1          EX0 = 1; //ä½¿èƒ½ INT0 ä¸­æ–­
  13   1          EA = 1;
  14   1          IRED = 1; //I/Oå£åˆå§‹åŒ–
  15   1      }
  16          extern char flag_running;
  17          extern u8 STA_F;        //é»˜è®¤æ˜¯F1æ¨¡å¼
  18          extern u8 STA_main;     //ä¸»è¦çš„çŠ¶æ€æ ‡å¿—ä½
  19          void ired() interrupt 0 //å¤–éƒ¨ä¸­æ–­0æœåŠ¡å‡½æ•°
  20          {
  21   1          u8 ired_high_time = 0;
  22   1          u16 time_cnt = 0;
  23   1          u8 i = 0, j = 0;
  24   1          static char flag_lock = 0;
  25   1          if (IRED == 0)
  26   1          {
  27   2              time_cnt = 15;
  28   2              while ((!IRED) && (time_cnt)) //ç­‰å¾…å¼•å¯¼ä¿¡å·9msä½ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡10mså¼ºåˆ¶é€€å‡º
  29   2              {
  30   3                  delay_ms(1);
  31   3                  time_cnt--;
  32   3                  if (time_cnt == 0)
  33   3                      return;
  34   3              }
  35   2              if (IRED) //å¼•å¯¼ä¿¡å·9msä½ç”µå¹³å·²è¿‡ï¼Œè¿›å…¥4.5msé«˜ç”µå¹³
  36   2              {
  37   3                  time_cnt = 7;
  38   3                  while (IRED && time_cnt) //ç­‰å¾…å¼•å¯¼ä¿¡å·4.5msé«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡5mså¼ºåˆ¶é€€å‡º
  39   3                  {
  40   4                      delay_ms(1);
  41   4                      time_cnt--;
  42   4                      if (time_cnt == 0)
  43   4                          return;
  44   4                  }
  45   3                  for (i = 0; i < 4; i++) //å¾ªç¯4æ¬¡ï¼Œè¯»å–4ä¸ªå­—èŠ‚æ•°æ®
  46   3                  {
  47   4                      for (j = 0; j < 8; j++) //å¾ªç¯8æ¬¡è¯»å–æ¯ä½æ•°æ®å³ä¸€ä¸ªå­—èŠ‚
  48   4                      {
  49   5                          // time_cnt = 600;
  50   5                          while ((IRED == 0) && time_cnt) //ç­‰å¾…æ•°æ®1æˆ–0å‰é¢çš„0.56msç»“æŸï¼Œè‹¥è¶…è¿‡6m
             -så¼ºåˆ¶é€€å‡º
  51   5                          {
  52   6                              delay_us(5);
  53   6                              // time_cnt--;
C51 COMPILER V9.60.0.0   IR                                                                09/11/2021 10:27:04 PAGE 2   

  54   6                              // if (time_cnt == 0)
  55   6                              //     return;
  56   6                          }
  57   5                          time_cnt = 15;
  58   5                          while (IRED) //ç­‰å¾…æ•°æ®1æˆ–0åé¢çš„é«˜ç”µå¹³ç»“æŸï¼Œè‹¥è¶…è¿‡2mså¼ºåˆ¶é€€å‡º
  59   5                          {
  60   6                              delay_10us(10); //çº¦0.1ms
  61   6                              ired_high_time++;
  62   6                              if (ired_high_time > 20)
  63   6                                  return;
  64   6                          }
  65   5                          gired_data[i] >>= 1;     //å…ˆè¯»å–çš„ä¸ºä½ä½ï¼Œç„¶åæ˜¯é«˜ä½
  66   5                          if (ired_high_time >= 8) //å¦‚æœé«˜ç”µå¹³æ—¶é—´å¤§äº0.8msï¼Œæ•°æ®åˆ™ä¸º1ï¼Œå¦åˆ™ä¸
             -º0
  67   5                              gired_data[i] |= 0x80;
  68   5                          ired_high_time = 0; //é‡æ–°æ¸…é›¶ï¼Œç­‰å¾…ä¸‹ä¸€æ¬¡è®¡ç®—æ—¶é—´
  69   5                      }
  70   4                  }
  71   3              }
  72   2              if (gired_data[2] != ~gired_data[3]) //æ ¡éªŒæ§åˆ¶ç ä¸åç ï¼Œé”™è¯¯åˆ™è¿”å›
  73   2              {
  74   3      
  75   3                  for (i = 0; i < 4; i++)
  76   3                      gired_data[i] = 0;
  77   3                  return;
  78   3              }
  79   2              for (i = 0; i < 17; i++)
  80   2              {
  81   3                  if (gired_data[2] == key_table[i])
  82   3                  {
  83   4                      key_flag = i;
  84   4                      if (key_flag == 16)
  85   4                      {
  86   5      
  87   5                          if (flag_lock % 2 == 0)
  88   5                          {
  89   6                              STA_main = STA_main | 0x40;
  90   6                          }
  91   5                          else
  92   5                          {
  93   6                              STA_main = STA_main & 0xbf;
  94   6                          }
  95   5                          flag_lock++;
  96   5                      }
  97   4                      if ((STA_main & 0x40) != 0x40)
  98   4                      {
  99   5                          if ((key_flag == 15) && ((STA_main & 0x80) == 0x80))
 100   5                          {
 101   6                              STA_F++;
 102   6                              if (STA_F > 9)
 103   6                              {
 104   7                                  STA_F = 9;
 105   7                              }
 106   6                          }
 107   5                          else if ((key_flag == 14) && ((STA_main & 0x80) == 0x80))
 108   5                          {
 109   6                              STA_F--;
 110   6                              if (STA_F < 1)
 111   6                              {
 112   7                                  STA_F = 1;
 113   7                              }
 114   6                          }
C51 COMPILER V9.60.0.0   IR                                                                09/11/2021 10:27:04 PAGE 3   

 115   5                          else if ((key_flag == 3) || (key_flag == 4) || (key_flag == 5))
 116   5                          {
 117   6                              STA_Mode = key_flag - 2;
 118   6                          }
 119   5                      }
 120   4                  }
 121   3              }
 122   2          }
 123   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    502    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     22       5
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
